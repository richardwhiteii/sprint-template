# Sprint Help

Get help with the sprint workflow, understand commands, and troubleshoot issues.

## Quick Start

```
/sprint help              # Show this help
/sprint init              # Initialize sprint from punchlist
/sprint 1                 # Start Phase 1
/sprint                   # Continue current phase
```

## Overview

The sprint workflow is a fully automated development system that takes your project from planning to shipped features:

```
punchlist-builder → /sprint init → /sprint 1 → /sprint 2 → ... → Done!
         ↓               ↓             ↓            ↓
   PUNCHLIST.md   .sprint-config  GitHub Issues  PRs merged
                   + Milestones   + Branches     + Tests passing
```

**What it does:**
1. Converts punchlist items into GitHub Issues
2. Creates feature branches using git worktrees
3. Implements features using specialized agents
4. Runs tests and fixes failures automatically
5. Creates and merges Pull Requests
6. Closes issues after QA verification
7. Repeats until all phases complete

**Key benefit:** You define what to build once (in the punchlist), then the system handles everything from issue creation to deployment.

## Prerequisites

Before running `/sprint init` or `/sprint`, ensure you have:

### Required Tools
- **GitHub CLI (`gh`)** - Must be authenticated
  ```bash
  gh auth login
  gh auth status  # Verify authentication
  ```

- **Git** - Repository with dev branch
  ```bash
  git -C .bare branch  # Should show 'dev' branch
  ```

### Required Files
- **Punchlist files** - Generated by punchlist-builder agent
  - `dev/PUNCHLIST.md` - Main index with phase metadata
  - `dev/PUNCHLIST_001.md` - Phases 1-2 details (optional)
  - `dev/PUNCHLIST_002.md` - Phases 3-4 details (optional)
  - `dev/PUNCHLIST_003.md` - Phases 5-6 details (optional)

### Repository Setup
- Working directory must be project root
- Dev branch must exist and be accessible
- Remote repository must be configured (for PRs)

## Git Repository Structure

This project uses a bare repository with worktrees:

```
/project-root/
├── .bare/           # Bare repo (shared git data)
├── main/            # Worktree: stable releases (on main branch)
├── dev/             # Worktree: active development (on dev branch)
└── feat-XXX/        # Worktree: temporary feature branches
```

**Key commands:**
- Worktree operations: `git -C .bare worktree [add|remove|list]`
- Branch promotion dev→test: `git push origin dev:test` (from dev worktree)
- Branch promotion test→main: `git merge origin/test` (from main worktree)

**Branch structure:**
- `main` - Stable releases (checked out in main/)
- `test` - BRANCH ONLY (no worktree, promoted via push)
- `dev` - Active development (checked out in dev/)
- `feature/*` - Feature branches (checked out in feat-XXX/)

## Command Reference

### /sprint init

**Purpose:** Initialize sprint configuration from punchlist

**What it does:**
- Reads `PUNCHLIST.md` to extract phase metadata
- Generates `.sprint-config.json` with phase definitions
- Creates GitHub milestones for each phase
- Verifies git setup and GitHub authentication
- Reports initialization status

**Usage:**
```bash
/sprint init                    # Initialize from dev/PUNCHLIST.md
/sprint init path=./docs        # Initialize from custom directory
```

**Output:**
- `.sprint-config.json` in project root
- GitHub milestones created
- Verification report

**When to use:** Once per project, before starting any sprint work

---

### /sprint

**Purpose:** Continue current phase (resume work)

**What it does:**
- Reads `.sprint-config.json`
- Checks for open GitHub issues
- Continues implementation of open issues
- Completes current phase if all issues closed

**Usage:**
```bash
/sprint                         # Continue where you left off
```

**When to use:**
- After interruptions or errors
- To resume work on current phase
- When you want to continue without specifying a phase

---

### /sprint N

**Purpose:** Start specific phase N

**What it does:**
- Reads phase N configuration from `.sprint-config.json`
- Creates GitHub Issues from punchlist (if not started)
- Runs full implementation loop for all tickets
- Updates phase status to complete when done

**Usage:**
```bash
/sprint 1                       # Start Phase 1
/sprint 2                       # Start Phase 2
/sprint phase=3                 # Alternative syntax
```

**When to use:**
- Starting a new phase
- Jumping to a specific phase
- After `/sprint init` completes

---

### /sprint help

**Purpose:** Show this help documentation

**Usage:**
```bash
/sprint help                    # Display help
```

## Workflow Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                      SPRINT WORKFLOW                            │
└─────────────────────────────────────────────────────────────────┘

Step 1: Build Punchlist
┌─────────────────────┐
│ punchlist-builder   │  User provides PRD or project description
│                     │  Agent generates PUNCHLIST.md with phases
└──────────┬──────────┘
           │
           ▼
Step 2: Initialize Sprint
┌─────────────────────┐
│   /sprint init      │  Parses punchlist
│                     │  Creates .sprint-config.json
│                     │  Creates GitHub milestones
└──────────┬──────────┘
           │
           ▼
Step 3: Execute Phases (repeat for each phase)
┌─────────────────────┐
│    /sprint N        │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE IMPLEMENTATION LOOP                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  For each ticket in phase:                                      │
│                                                                 │
│  1. CREATE ISSUES                                               │
│     └─> github-issue-writer agent                              │
│         - Reads punchlist                                       │
│         - Creates GitHub Issues with milestone                  │
│                                                                 │
│  2. CREATE WORKTREE                                             │
│     └─> git-agent(create-worktree)                             │
│         - Creates isolated branch: feat-PREFIX-NNN              │
│                                                                 │
│  3. IMPLEMENT                                                   │
│     └─> focused-code-writer agent                              │
│         - Reads GitHub Issue                                    │
│         - Implements feature                                    │
│                                                                 │
│  4. TEST                                                        │
│     └─> test-runner-agent                                      │
│         - Runs tests (max 3 attempts)                          │
│         - Fixes failures automatically                          │
│                                                                 │
│  5. COMMIT                                                      │
│     └─> git-agent(commit)                                      │
│         - Commits changes with conventional message             │
│                                                                 │
│  6. CREATE PR                                                   │
│     └─> git-agent(push-and-pr)                                 │
│         - Pushes branch                                         │
│         - Creates Pull Request                                  │
│         - Links to GitHub Issue                                 │
│                                                                 │
│  7. MERGE PR                                                    │
│     └─> git-agent(merge-pr)                                    │
│         - Merges PR to dev branch                              │
│         - Uses squash merge                                     │
│                                                                 │
│  8. VERIFY & CLOSE                                              │
│     └─> qa-agent                                               │
│         - Verifies implementation                               │
│         - Closes GitHub Issue                                   │
│                                                                 │
│  9. CLEANUP                                                     │
│     └─> git-agent(cleanup)                                     │
│         - Removes worktree                                      │
│                                                                 │
│  [Repeat for next ticket or run parallel if configured]        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
           │
           ▼
Step 4: Phase Complete
┌─────────────────────┐
│  Update config      │  Mark phase status = "complete"
│  Report summary     │  Show completed work
│  Prompt next phase  │  Ask to start next phase
└─────────────────────┘
```

## Key Concepts

### Phases
A **phase** is a group of related tickets that should be completed together.

- Defined in punchlist by the punchlist-builder agent
- Each phase has a milestone for tracking progress
- Phases run sequentially (1, then 2, then 3, etc.)
- Phase status: `not_started` → `in_progress` → `complete`

**Example:**
```json
{
  "1": {
    "name": "MVP Core Printing",
    "ticket_range": "001-004",
    "milestone": "Phase 1: MVP Core Printing",
    "status": "in_progress"
  }
}
```

---

### Parallel Tickets
**Parallel tickets** are tickets within a phase that can be worked on simultaneously.

- Reduces total development time
- Uses git worktrees for isolation
- Identified by punchlist-builder based on independence
- Merged sequentially after implementation

**Example:**
```json
{
  "2": {
    "name": "Enhanced Formatting",
    "parallel_tickets": ["006", "007"],
    ...
  }
}
```

This means tickets PREFIX-006 and PREFIX-007 can be developed at the same time.

**How it works:**
1. Both branches created simultaneously
2. Both features implemented in parallel
3. Both tested independently
4. PRs created for both
5. PRs merged sequentially to avoid conflicts

---

### Milestones
GitHub milestones track progress for each phase.

- Created automatically by `/sprint init`
- All issues in a phase assigned to the same milestone
- Used to query open/closed issues
- Provides visual progress tracking on GitHub

**Example milestones:**
- Phase 1: MVP Core Printing
- Phase 2: Enhanced Formatting
- Phase 3: Output Options

---

### Worktrees
Git worktrees provide isolated workspaces for feature development.

**Why worktrees?**
- Develop multiple features simultaneously
- Each feature has its own branch and directory
- No need to switch branches or stash changes
- Clean separation of work

**Project Structure:**
```
/home/user/project/              # Project root
├── .bare/                       # Bare repo (shared git data)
├── .claude/                     # Agent and command definitions
├── main/                        # Stable releases worktree (on main branch)
├── dev/                         # Active development worktree (on dev branch, punchlist files)
└── feat-XXX/                    # Feature worktrees (temporary)

Branches:
- main     # Stable releases (checked out in main/)
- test     # QA/integration (BRANCH ONLY, no worktree)
- dev      # Active development (checked out in dev/)
- feature/*  # Feature branches (checked out in feat-XXX/)
```

**How sprint uses worktrees:**
1. Project root at `/home/user/project` (contains .bare/, .claude/)
2. Dev worktree at `/home/user/project/dev` (for punchlist files and active development)
3. Feature worktree at `/home/user/project/feat-XXX` (temporary, for individual tickets)
4. Main worktree at `/home/user/project/main` (for stable releases)
5. Test is a BRANCH (not a worktree) used for QA/integration

**Worktree operations:**
All worktree commands must use `git -C .bare`:
```bash
# Create feature worktree
git -C .bare worktree add feat-XXX -b feature/TICKET-desc dev

# List worktrees
git -C .bare worktree list

# Remove worktree
git -C .bare worktree remove feat-XXX
```

**Lifecycle:**
```
create-worktree → implement → test → commit → push → merge → cleanup
```

After merge, the worktree is automatically removed.

---

### Specialized Agents
The sprint workflow delegates work to specialized agents:

- **github-issue-writer** - Converts punchlist to GitHub Issues
- **git-agent** - All git operations (7 modes)
- **focused-code-writer** - Implements features
- **test-runner-agent** - Runs and fixes tests
- **qa-agent** - Verifies implementation and closes issues

Each agent operates independently with clear inputs/outputs.

---

### Configuration File
`.sprint-config.json` stores all sprint configuration.

**Location:** Project root directory

**Key fields:**
- `project` - Project name
- `repo` - GitHub repository (owner/name)
- `phases` - Phase definitions and status
- `parallel_tickets` - Which tickets can run in parallel
- `auto_merge` - Whether to auto-merge PRs
- `max_test_retries` - Test retry limit

**Example:**
```json
{
  "project": "project-name",
  "repo": "owner/repo",
  "project_root": "$PROJECT_ROOT",
  "base_branch": "dev",
  "ticket_prefix": "PREFIX",
  "auto_merge": true,
  "max_test_retries": 3,
  "phases": { ... }
}
```

## FAQ

### How do I start a new project?

1. **Create punchlist** using punchlist-builder agent:
   ```
   Ask the agent to build a punchlist from your PRD or project description
   ```

2. **Initialize sprint:**
   ```bash
   /sprint init
   ```

3. **Start Phase 1:**
   ```bash
   /sprint 1
   ```

4. **Let it run!** The system handles everything automatically.

---

### What if a phase fails?

**Scenario 1: Test failures**
- System retries up to 3 times automatically
- If still failing, issue marked "needs-attention"
- You can manually fix and run `/sprint` to continue

**Scenario 2: Merge conflicts**
- git-agent attempts automatic resolution
- If can't resolve, escalates to you
- Fix conflicts, then run `/sprint` to continue

**Scenario 3: Implementation errors**
- focused-code-writer reports error
- System logs error and continues to next ticket
- Review error, fix manually, then run `/sprint`

**Recovery:** Just run `/sprint` to continue where you left off.

---

### How do parallel tickets work?

1. **Identification:** punchlist-builder marks tickets that are independent
2. **Configuration:** Added to `.sprint-config.json` under `parallel_tickets`
3. **Execution:** Both worktrees created, both implemented simultaneously
4. **Testing:** Each tested independently
5. **Merging:** Merged sequentially (first PR, then second PR)
6. **Conflict handling:** If conflicts occur, git-agent resolves them

**Example timeline:**
```
Sequential (default):  [006: 30min] → [007: 30min] = 60min total
Parallel (optimized):  [006: 30min]
                       [007: 30min]  = 30min total (50% faster!)
```

---

### Where are the config files?

- **Punchlist files:** `dev/PUNCHLIST*.md`
- **Sprint config:** `.sprint-config.json` (project root)
- **Agent definitions:** `.claude/agents/*.md`
- **Command definitions:** `.claude/commands/*.md`

All files are in your project directory.

---

### How do I skip a phase?

You can't skip phases, but you can mark them complete manually:

1. Edit `.sprint-config.json`
2. Change phase status to `"complete"`
3. Run `/sprint [next-phase]`

**Warning:** This skips all implementation for that phase!

---

### Can I run multiple phases in parallel?

No. Phases run sequentially because later phases often depend on earlier ones.

However, **tickets within a phase** can run in parallel if marked in config.

---

### How do I promote code through the branches (dev → test → main)?

**Branch Flow:**
```
feature/TICKET → dev → test (branch) → main
```

**After completing a batch of tickets (merged to dev):**
```bash
# Promote dev to test (fast-forward push from dev worktree)
cd dev
git push origin dev:test
# Test branch is now updated with dev changes
```

**After QA passes on test branch:**
```bash
# Promote test to main (merge from main worktree)
cd main
git pull origin main
git fetch origin test
git merge origin/test
# Run final verification
cargo test
git tag vX.Y.Z
git push origin main --tags
```

**Key Points:**
- `test` is a BRANCH ONLY (no worktree)
- Promote dev → test via `git push origin dev:test` from dev worktree
- Promote test → main via merge in main worktree
- After merging to test, run integration tests
- Only promote to main after QA verification passes

---

### What if I need to pause work?

Just stop! The system tracks state in:
- `.sprint-config.json` (phase status)
- GitHub Issues (open/closed)
- Git branches (pushed to remote)

To resume: `/sprint`

---

### How do I customize the workflow?

Edit `.sprint-config.json`:

- **Change test retry limit:** Modify `max_test_retries`
- **Disable auto-merge:** Set `auto_merge: false`
- **Add parallel tickets:** Add to `parallel_tickets` array
- **Change base branch:** Modify `base_branch`

Changes take effect immediately (no restart needed).

---

### What happens if GitHub rate limits hit?

- System waits and retries automatically
- If persistent, errors and asks you to wait
- Check rate limit: `gh api rate_limit`

## Troubleshooting

### "PUNCHLIST.md not found"

**Cause:** Punchlist file missing or in wrong location

**Solution:**
```bash
# Check if punchlist exists
ls dev/PUNCHLIST.md

# If missing, create it using punchlist-builder agent
# Then retry /sprint init
```

---

### "Not a git repository"

**Cause:** Running from wrong directory or no git repo

**Solution:**
```bash
# Initialize bare repo if needed
git init --bare .bare
git -C .bare branch dev main
git -C .bare worktree add main main
git -C .bare worktree add dev dev

# Or navigate to project root
cd /path/to/project
```

---

### "GitHub CLI not authenticated"

**Cause:** `gh` not logged in

**Solution:**
```bash
gh auth login
gh auth status  # Verify
```

---

### "Dev branch does not exist"

**Cause:** Missing dev branch

**Solution:**
```bash
# Create dev branch in bare repo
git -C .bare branch dev main
# Create dev worktree
git -C .bare worktree add dev -b dev
# Push to remote
cd dev && git push -u origin dev
```

---

### "Phase already complete"

**Cause:** Trying to start a phase that's already done

**Solution:**
- Check phase status in `.sprint-config.json`
- If you want to rerun, change status to `"not_started"`
- Or start the next phase: `/sprint [N+1]`

---

### "Could not parse phase table"

**Cause:** Invalid punchlist format

**Solution:**
Ensure PUNCHLIST.md has this table structure:
```markdown
| Phase | Name | Status | Hours | Tickets |
|-------|------|--------|-------|---------|
| 1 | MVP Core | [ ] | 4h | PREFIX-001 to 004 |
```

---

### "Test failures after max retries"

**Cause:** Tests failing and system can't fix automatically

**Solution:**
1. Check test output in agent logs
2. Fix tests manually
3. Run `/sprint` to continue

---

### "PR merge failed"

**Cause:** Merge conflicts or CI failures

**Solution:**
1. Check PR on GitHub for details
2. If conflicts: git-agent will attempt resolution
3. If CI failing: test-runner-agent will retry
4. If persistent: fix manually and merge via GitHub UI
5. Close issue manually: `gh issue close #N`
6. Run `/sprint` to continue

---

### "Parallel tickets conflicted"

**Cause:** Two parallel tickets modified the same files

**Solution:**
- System attempts automatic resolution
- If can't resolve, you'll be prompted
- Fix conflicts manually in second PR
- Merge both PRs
- Run `/sprint` to continue

---

### ".sprint-config.json is invalid"

**Cause:** Corrupted or malformed JSON

**Solution:**
```bash
# Validate JSON
cat .sprint-config.json | jq .

# If invalid, fix syntax errors
# Or regenerate: /sprint init --force
```

---

### "No open issues but phase not complete"

**Cause:** Phase status out of sync

**Solution:**
1. Verify all issues closed on GitHub
2. Manually update `.sprint-config.json`:
   ```json
   "status": "complete"
   ```
3. Run `/sprint` to continue to next phase

## Need More Help?

Ask follow-up questions about:
- Specific error messages
- Agent behavior
- Configuration options
- Workflow customization
- Git operations
- GitHub integration
- Testing strategy

Example questions:
- "How does git-agent handle merge conflicts?"
- "Can I change the PR title format?"
- "What tests does test-runner-agent run?"
- "How do I add custom validation to QA?"

The system is designed to be flexible and extensible. Ask about any aspect of the workflow!

## Related Documentation

- **Sprint Command:** `.claude/commands/sprint.md` - Full technical details
- **Sprint Init:** `.claude/commands/sprint-init.md` - Initialization reference
- **Git Agent:** `.claude/agents/git-agent.md` - Git operations
- **GitHub Issue Writer:** `.claude/agents/github-issue-writer.md` - Issue creation
- **Test Runner:** `.claude/agents/test-runner-agent.md` - Testing workflow
- **QA Agent:** `.claude/agents/qa-agent.md` - Quality assurance
- **Punchlist Builder:** `.claude/agents/punchlist-builder.md` - Punchlist generation

## Quick Reference Card

```
┌─────────────────────────────────────────────────────────────────┐
│                    SPRINT QUICK REFERENCE                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  First Time Setup:                                              │
│    1. Build punchlist (punchlist-builder agent)                │
│    2. /sprint init                                             │
│    3. /sprint 1                                                │
│                                                                 │
│  Common Commands:                                               │
│    /sprint              Continue current phase                 │
│    /sprint N            Start phase N                          │
│    /sprint help         Show help                              │
│                                                                 │
│  Prerequisites:                                                 │
│    - gh auth login      GitHub CLI authenticated              │
│    - git branch dev     Dev branch exists                      │
│    - PUNCHLIST.md       Punchlist created                      │
│                                                                 │
│  Key Files:                                                     │
│    .sprint-config.json  Sprint configuration                   │
│    dev/PUNCHLIST*.md    Punchlist files                        │
│                                                                 │
│  Recovery:                                                      │
│    /sprint              Continue where you left off            │
│                                                                 │
│  Status Check:                                                  │
│    cat .sprint-config.json | jq .phases                       │
│    gh issue list --state open                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```
